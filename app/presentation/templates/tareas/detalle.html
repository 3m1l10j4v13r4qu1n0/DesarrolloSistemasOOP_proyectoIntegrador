<!-- 
==================================================
Detalle de una tarea específica - CORREGIDO
==================================================
-->
<!-- archivo modificado con reemplazos solicitados -->
{% extends "layout.html" %}

{% block title %}Detalle de Tarea{% endblock %}

{% block content %}
<div>
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2 style="color: #667eea;">Detalle de la Tarea</h2>
        <div>
            {% if proyecto %}
            <a href="{{ url_for('proyectos.detalle', id_proyecto=proyecto.id_proyecto) }}" class="btn btn-info">
                <i class="bi bi-folder"></i> Ver Proyecto
            </a>
            {% endif %}
            <a href="{{ url_for('tareas.listar') }}" class="btn btn-secondary">
                <i class="bi bi-arrow-left"></i> Volver
            </a>
        </div>
    </div>
    
    {% include('partials/_header.html') %}

    <div class="card">
        <div class="card-header">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h4 class="mb-0"><i class="bi bi-check2-square"></i> {{ tarea.titulo }}</h4>
                <div>
                    <span class="badge {% if tarea.prioridad=='urgente' %}bg-danger{% elif tarea.prioridad=='alta' %}bg-warning text-dark{% elif tarea.prioridad=='media' %}bg-info{% else %}bg-secondary{% endif %}" style="font-size:1rem;">{{ tarea.prioridad|capitalize }}</span>
                    <span class="badge {% if tarea.estado=='completada' %}bg-success{% elif tarea.estado=='en_progreso' %}bg-primary{% elif tarea.estado=='bloqueada' %}bg-danger{% else %}bg-secondary{% endif %}" style="font-size:1rem;">{{ tarea.estado|replace('_',' ')|capitalize }}</span>
                </div>
            </div>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <p><strong>ID:</strong> {{ tarea.id_tarea }}</p>
                    <p><strong>Proyecto:</strong> 
                        {% if proyecto %}
                        <a href="{{ url_for('proyectos.detalle', id_proyecto=proyecto.id_proyecto) }}">{{ proyecto.nombre }}</a>
                        {% else %}<span class="text-muted">No asignado</span>{% endif %}
                    </p>
                    <p><strong>Asignado a:</strong> 
                        {% if miembro_asignado %}
                        <a href="{{ url_for('miembros.detalle', id_miembro=miembro_asignado.id_miembro) }}">{{ miembro_asignado.nombre }} {{ miembro_asignado.apellido }}</a><br>
                        <small class="text-muted">{{ miembro_asignado.rol }} - {{ miembro_asignado.email }}</small>
                        {% else %}<span class="text-muted">Sin asignar</span>{% endif %}
                    </p>
                </div>
                <div class="col-md-6">
                    <p><strong>Fecha de Creación:</strong> {{ tarea.fecha_creacion if tarea.fecha_creacion else '-' }}</p>
                    <p><strong>Fecha de Vencimiento:</strong> {{ tarea.fecha_vencimiento if tarea.fecha_vencimiento else 'Sin fecha de vencimiento' }}</p>
                </div>
            </div>

            <div class="row mt-3">
                <div class="col-12"><p><strong>Descripción:</strong></p><div class="alert alert-light">{{ tarea.descripcion if tarea.descripcion else 'Sin descripción' }}</div></div>
            </div>

            <div class="row mt-3">
                <div class="col-12"><strong>Cambiar Estado:</strong>
                    <form method="POST" action="{{ url_for('tareas.cambiar_estado', id_tarea=tarea.id_tarea) }}" style="display:inline-block; margin-left:10px;">
                        <div class="btn-group" role="group">
                            <button type="submit" name="estado" value="pendiente" class="btn btn-sm {% if tarea.estado=='pendiente' %}btn-secondary{% else %}btn-outline-secondary{% endif %}">Pendiente</button>
                            <button type="submit" name="estado" value="en_progreso" class="btn btn-sm {% if tarea.estado=='en_progreso' %}btn-primary{% else %}btn-outline-primary{% endif %}">En Progreso</button>
                            <button type="submit" name="estado" value="completada" class="btn btn-sm {% if tarea.estado=='completada' %}btn-success{% else %}btn-outline-success{% endif %}">Completada</button>
                            <button type="submit" name="estado" value="bloqueada" class="btn btn-sm {% if tarea.estado=='bloqueada' %}btn-danger{% else %}btn-outline-danger{% endif %}">Bloqueada</button>
                        </div>
                    </form>
                </div>
            </div>

            <div class="row mt-3">
                <div class="col-12"><strong>Acciones Rápidas:</strong><div style="display:inline-block; margin-left:10px;">
                        {% if tarea.estado!='completada' and tarea.id_miembro_asignado %}
                        <form method="POST" action="{{ url_for('tareas.completar_tarea', id_tarea=tarea.id_tarea) }}" style="display:inline;"><button type="submit" class="btn btn-success btn-sm"><i class="bi bi-check-circle"></i> Completar</button></form>
                        {% endif %}

                        {% if tarea.estado!='bloqueada' %}
                        <form method="POST" action="{{ url_for('tareas.bloquear_tarea', id_tarea=tarea.id_tarea) }}" style="display:inline;"><button type="submit" class="btn btn-warning btn-sm"><i class="bi bi-pause-circle"></i> Bloquear</button></form>
                        {% endif %}

                        {% if tarea.id_miembro_asignado %}
                        <form method="POST" action="{{ url_for('tareas.desasignar_tarea', id_tarea=tarea.id_tarea) }}" style="display:inline;"><button type="submit" class="btn btn-secondary btn-sm" onclick="return confirm('¿Desasignar esta tarea?')"><i class="bi bi-person-dash"></i> Desasignar</button></form>
                        {% endif %}
                </div></div>
            </div>

            <hr class="my-4">

            <div class="mt-3">
                <a href="{{ url_for('tareas.editar', id_tarea=tarea.id_tarea) }}" class="btn btn-warning"><i class="bi bi-pencil"></i> Editar Tarea</a>
                {% if proyecto %}<a href="{{ url_for('proyectos.detalle', id_proyecto=proyecto.id_proyecto) }}" class="btn btn-info"><i class="bi bi-folder"></i> Ir al Proyecto</a>{% endif %}
                {% if miembro_asignado %}<a href="{{ url_for('miembros.detalle', id_miembro=miembro_asignado.id_miembro) }}" class="btn btn-info"><i class="bi bi-person"></i> Ver Miembro</a>{% endif %}
                <form method="POST" action="{{ url_for('tareas.eliminar', id_tarea=tarea.id_tarea) }}" style="display:inline;"><button type="submit" class="btn btn-danger" onclick="return confirm('¿Estás seguro de eliminar esta tarea?')"><i class="bi bi-trash"></i> Eliminar</button></form>
            </div>
        </div>
    </div>

    {% if proyecto %}
    <div class="card mt-4">
        <div class="card-header"><h5 class="mb-0"><i class="bi bi-folder"></i> Proyecto Asociado</h5></div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-8">
                    <h5>{{ proyecto.nombre }}</h5>
                    <p class="text-muted">{{ proyecto.descripcion if proyecto.descripcion else 'Sin descripción' }}</p>
                    <p><strong>Fechas:</strong> {{ proyecto.fecha_inicio }} - {{ proyecto.fecha_fin }}</p>
                </div>
                <div class="col-md-4 text-end">
                    <p><strong>Estado:</strong> <span class="badge {% if proyecto.estado=='activo' %}bg-success{% elif proyecto.estado=='finalizado' %}bg-primary{% else %}bg-secondary{% endif %}">{{ proyecto.estado|capitalize }}</span></p>
                    <p><a href="{{ url_for('tareas.listar') }}?proyecto={{ proyecto.id_proyecto }}" class="btn btn-outline-primary btn-sm">Ver todas las tareas</a></p>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    {% if miembro_asignado %}
    <div class="card mt-4">
        <div class="card-header"><h5 class="mb-0"><i class="bi bi-person"></i> Miembro Asignado</h5></div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-8">
                    <h5>{{ miembro_asignado.nombre }} {{ miembro_asignado.apellido }}</h5>
                    <p class="text-muted">{{ miembro_asignado.email }}</p>
                    <p><strong>Rol:</strong> {{ miembro_asignado.rol }}</p>
                    <p><strong>Fecha de Ingreso:</strong> {{ miembro_asignado.fecha_ingreso }}</p>
                </div>
                <div class="col-md-4 text-end">
                    <p><a href="{{ url
