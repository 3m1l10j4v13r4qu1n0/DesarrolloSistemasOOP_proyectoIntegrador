<!-- 
==================================================
Formulario para editar tarea
==================================================
-->
{% extends "layout.html" %}
{% block title %}Editar Tarea{% endblock %}
{% block content %}
<div>
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
        <h2 style="color:#667eea;">Editar Tarea</h2>
        <div>
            <a href="{{ url_for('tareas.detalle', id_tarea=tarea.id_tarea) }}" class="btn btn-info"><i class="bi bi-eye"></i> Ver Detalle</a>
            <a href="{{ url_for('tareas.listar') }}" class="btn btn-secondary"><i class="bi bi-arrow-left"></i> Volver</a>
        </div>
    </div>

    {% include 'partials/_header.html' %}

    <div class="card">
        <div class="card-header"><h4 class="mb-0"><i class="bi bi-pencil-square"></i> Editar Información de la Tarea</h4></div>
        <div class="card-body">
            <form method="POST" action="{{ url_for('tareas.actualizar', id_tarea=tarea.id_tarea) }}">
                <div class="row">
                    <div class="col-md-12 mb-3">
                        <label class="form-label">Título de la Tarea *</label>
                        <input type="text" class="form-control" name="titulo" required maxlength="150" value="{{ tarea.titulo }}">
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12 mb-3">
                        <label class="form-label">Descripción</label>
                        <textarea class="form-control" name="descripcion" rows="4" maxlength="1000">{{ tarea.descripcion }}</textarea>
                        <small class="text-muted">Máximo 1000 caracteres</small>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Proyecto</label>
                        <input type="text" class="form-control" value="{{ tarea.proyecto.nombre }}" disabled>
                        <small class="text-muted"><i class="bi bi-info-circle"></i> El proyecto no se puede cambiar</small>
                    </div>

                    <div class="col-md-6 mb-3">
                        <label class="form-label">Asignar a</label>
                        <select class="form-select" name="id_miembro_asignado">
                            <option value="">Sin asignar</option>
                            {% for miembro in miembros %}
                            <option value="{{ miembro.id_miembro }}" {% if tarea.id_miembro_asignado==miembro.id_miembro %}selected{% endif %}>{{ miembro.nombre }} {{ miembro.apellido }} - {{ miembro.rol }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Prioridad *</label>
                        <select class="form-select" id="prioridad" name="prioridad" required>
                            <option value="baja" {% if tarea.prioridad=='baja' %}selected{% endif %}>Baja</option>
                            <option value="media" {% if tarea.prioridad=='media' %}selected{% endif %}>Media</option>
                            <option value="alta" {% if tarea.prioridad=='alta' %}selected{% endif %}>Alta</option>
                            <option value="urgente" {% if tarea.prioridad=='urgente' %}selected{% endif %}>Urgente</option>
                        </select>
                    </div>

                    <div class="col-md-6 mb-3">
                        <label class="form-label">Estado *</label>
                        <select class="form-select" id="estado" name="estado" required>
                            <option value="pendiente" {% if tarea.estado=='pendiente' %}selected{% endif %}>Pendiente</option>
                            <option value="en_progreso" {% if tarea.estado=='en_progreso' %}selected{% endif %}>En Progreso</option>
                            <option value="completada" {% if tarea.estado=='completada' %}selected{% endif %}>Completada</option>
                            <option value="cancelada" {% if tarea.estado=='cancelada' %}selected{% endif %}>Cancelada</option>
                        </select>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Fecha de Creación</label>
                        <input type="text" class="form-control" disabled value="{% if tarea.fecha_creacion %}{{ tarea.fecha_creacion }}{% else %}-{% endif %}">
                    </div>

                    <div class="col-md-6 mb-3">
                        <label class="form-label">Fecha de Vencimiento</label>
                        <input type="date" class="form-control" name="fecha_vencimiento" value="{% if tarea.fecha_vencimiento %}{{ tarea.fecha_vencimiento }}{% endif %}">
                    </div>
                </div>

                <div class="alert alert-info">
                    <strong><i class="bi bi-info-circle"></i> Información de la Tarea:</strong>
                    <ul class="mb-0 mt-2">
                        <li>ID: <strong>{{ tarea.id_tarea }}</strong></li>
                        <li>Proyecto: <strong>{{ tarea.proyecto.nombre }}</strong></li>
                        <li>Fecha de creación: <strong>{% if tarea.fecha_creacion %}{{ tarea.fecha_creacion }}{% else %}-{% endif %}</strong></li>
                    </ul>
                </div>

                <div class="card mb-3"><div class="card-body"><h6>Vista Previa:</h6><span id="preview-prioridad" class="badge bg-info">Media</span> <span id="preview-estado" class="badge bg-secondary">Pendiente</span></div></div>

                <div class="mt-4">
                    <button type="submit" class="btn btn-warning"><i class="bi bi-save"></i> Actualizar Tarea</button>
                    <a href="{{ url_for('tareas.detalle', id_tarea=tarea.id_tarea) }}" class="btn btn-secondary"><i class="bi bi-x-circle"></i> Cancelar</a>

                    <form method="POST" action="{{ url_for('tareas.eliminar', id_tarea=tarea.id_tarea) }}" style="display:inline;" class="float-end">
                        <button type="submit" class="btn btn-danger" onclick="return confirm('¿Estás seguro de eliminar esta tarea?')"><i class="bi bi-trash"></i> Eliminar Tarea</button>
                    </form>
                </div>
            </form>
        </div>
    </div>
</div>
<script>
// Igual que original: vista previa + validación fechas
</script>
{% endblock %}
